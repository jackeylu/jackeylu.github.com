---
layout: post
title: ! '>对段错误调试文章的补遗和更正'
categories: []
tags:
- Uncategorized
status: publish
type: post
published: true
meta:
  blogger_blog: jmp-eax.blogspot.com
  blogger_author: JMP
  blogger_250ca80ed681db3745a15b2b9f221f45_permalink: '6291848319326323182'
---
&gt;<br> [chen@localhost seg]$ cat -n backtrace2.c<br>      1  #include &lt;stdio.h&gt;<br>      2  #include &lt;execinfo.h&gt;<br>      3  #include &lt;stdlib.h&gt;<br>      4  #include &lt;signal.h&gt;<br>      5<br>      6  /*<br>      7   * A dummy function to make the backtrace more interesting.<br>      8   */<br>      9  void<br>     10  dummy_function(void)<br>     11  {<br>     12          unsigned char *ptr = 0x00;<br>     13          *ptr = 0x00;<br>     14  }<br>     15<br>     16  void myfunc3(void)<br>     17  {<br>     18          dummy_function();<br>     19  }<br>     20<br>     21  void myfunc2(void)<br>     22  {<br>     23          myfunc3();<br>     24  }<br>     25<br>     26  void myfunc(int n)<br>     27  {<br>     28          if (n &gt; 1)<br>     29                  myfunc(n-1);<br>     30          else<br>     31                  myfunc2();<br>     32  }<br>     33<br>     34  void dump(int signo)<br>     35  {<br>     36          void *array[10];<br>     37          size_t size;<br>     38          char **strings;<br>     39          size_t i;<br>     40<br>     41          size = backtrace(array, 10);<br>     42          strings = backtrace_symbols(array,size);<br>     43<br>     44          printf("Obtained %zd stack frames.\n", size);<br>     45<br>     46<br>     47          for ( i = 0; i &lt; size ; ++i )<br>     48                  printf("%s\n",strings[i]);<br>     49<br>     50          free(strings);<br>     51          exit(0);<br>     52  }<br>     53<br>     54  int<br>     55  main(void)<br>     56  {<br>     57          signal(SIGSEGV, &amp;dump);<br>     58<br>     59          myfunc(3);<br>     60<br>     61          return 0;<br>     62  }<br> <br> g++ -g -rdynamic backtrace2.c -o backtrace2<br> [chen@localhost seg]$ ./backtrace2<br> Obtained 10 stack frames.<br> ./backtrace2(_Z4dumpi+0x19) [0x804889b]<br> [0xa65420]<br> <font color="#ff6666"><b>./backtrace2(_Z14dummy_functionv+0x10) [0x8048804]</b></font><br> ./backtrace2(_Z7myfunc3v+0x8) [0x8048812]<br> ./backtrace2(_Z7myfunc2v+0x8) [0x804881c]<br> ./backtrace2(_Z6myfunci+0x21) [0x804883f]<br> ./backtrace2(_Z6myfunci+0x1a) [0x8048838]<br> ./backtrace2(_Z6myfunci+0x1a) [0x8048838]<br> ./backtrace2(main+0x31) [0x8048873]<br> /lib/libc.so.6(__libc_start_main+0xdc) [0x3e1dec]<br> <br> <br> objdump -d -S backtrace2<br> <br> 080487f4 &lt;_Z14dummy_functionv&gt;:<br> /*<br>  * A dummy function to make the backtrace more interesting.<br>  */<br> void<br> dummy_function(void)<br>  80487f4:    55                       push   %ebp<br>  80487f5:    89 e5                    mov    %esp,%ebp<br>  80487f7:    83 ec 10                 sub    $0x10,%esp<br> {<br>     unsigned char *ptr = 0x00;<br>  80487fa:    c7 45 fc 00 00 00 00     movl   $0x0,0xfffffffc(%ebp)<br>     *ptr = 0x00;<br>  8048801:    8b 45 fc                 mov    0xfffffffc(%ebp),%eax<br>  <b><font color="#ff6666">8048804: </font></b>   c6 00 00                 movb   $0x0,(%eax)<br> }<br>  8048807:    c9                       leave  <br>  8048808:    c3                       ret    <br>  8048809:    90                       nop    <br> <br> 上述例子说明我之前发布的内容是错误的，通过objdump是可以判断到具体哪一行代码出现段错误。<br> 真是太好了！再次赞叹GNU组织开发出的glibc<br> <br>
